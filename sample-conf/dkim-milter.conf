# DKIM Milter sample configuration file
# See the manual page dkim-milter.conf(5) for reference documentation.

#
# General
#

# Start the milter listening on port 3000:
socket = inet:localhost:3000
#socket = unix:/run/dkim-milter.sock

# Whether to only "sign", only "verify", or make this decision "auto"matically:
mode = auto
#mode = sign

# Read signing keys and signing senders from the following files:
signing_senders = <sample-conf/signing-senders
signing_keys = <sample-conf/signing-keys
#signing_keys = file:sample-conf/signing-keys
#signing_keys = sqlite://mail-config.db
#signing_keys = sqlite://mail-config.db#dkim_signing_keys

# Read connection-specific configuration overrides from this file:
connection_overrides = <sample-conf/connection-overrides

# Read recipient-specific configuration overrides from this file:
recipient_overrides = <sample-conf/recipient-overrides

# Treat message transactions from these networks as eligible for signing:
trusted_networks = loopback
#trusted_networks = 12.3.4.56/28, 2001:1600:2:3::4cde

# Whether to treat messages from authenticated senders as eligible for signing:
trust_authenticated_senders = yes

# Use this authserv-id in generated Authentication-Results headers:
authserv_id = mail.example.com

# Whether to delete forged Authentication-Results headers
# ("forged" means *incoming* authserv-id equals *our* authserv-id).
# Important: If you use an earlier milter that adds such headers and takes care
# of deletion itself (eg, SPF Milter), you must disable this setting, else those
# legitimate headers will be deleted by DKIM Milter.
delete_incoming_authentication_results = yes

# Whether to only accept signing senders (in Sender or From header) that match
# the envelope sender (in MAIL FROM) for signing.
require_envelope_sender_match = no

# Log destination (syslog, stderr) and log level (error, warn, info, debug).
log_destination = syslog
log_level = info

# Maximum time to allow when querying for DKIM public key records.
lookup_timeout = 10s

# Whether to operate without applying changes to messages or rejecting messages.
dry_run = no

#
# Signing
#

# When signing, include the following headers in the signature. Value "default"
# selects the default set of headers plus additional colon-separated headers
# after a semicolon. Value "all" selects all headers present.
sign_headers = default
#sign_headers = default; Message-ID
#sign_headers = all
#sign_headers = From:To:Cc:Date:Subject

# Value "default" in parameter sign_headers refers to this set of headers:
default_signed_headers = From:Reply-To:Subject:Date:To:Cc:Resent-Date:Resent-From:Resent-To:Resent-Cc:In-Reply-To:References:List-Id:List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive

# When value "all" is used in parameter sign_headers, exclude these headers:
default_unsigned_headers = Return-Path:Received:Comments:Keywords

# When signing, oversign these headers, that is include them in h= once more
# than actually present. Value "signed" oversigns all headers included in the
# h= tag, value "signed-extended" additionally oversigns all headers in the
# default set even if not present in the message.
oversign_headers =
#oversign_headers = From:To
#oversign_headers = signed
#oversign_headers = signed-extended

# When signing, canonicalize using the following algorithm:
canonicalization = relaxed/simple

# When signing, set the valid duration in the x= tag to this value:
expiration = 5d
#expiration = never

# Whether to record the length of the signed body in the l= tag:
limit_body_length = no

# Whether to record the original headers in the z= tag:
copy_headers = no

# Whether to include tag r=y in signatures (RFC 6651, DKIM Failure Reporting):
request_reports = no

#
# Verification
#

# Whether to accept expired signatures.
allow_expired = no

# Whether to accept signatures with a timestamp in the future.
allow_timestamp_in_future = no

# Whether to accept signatures using the SHA-1 hash algorithm.
# (This setting is only effective if DKIM Milter was compiled with feature
# "pre-rfc8301".)
allow_sha1 = no

# Minimum acceptable RSA public key size.
min_rsa_key_bits = 1024

# When verifying, require these headers to be signed.
required_signed_headers = From*
#required_signed_headers = From:To:Subject

# When verifying, whether to accept messages whose body is only partially
# included in a signature through an l= tag limit.
forbid_unsigned_content = no

# The set of signature verification results to reject with an SMTP error reply:
# "missing": reject messages without DKIM signature
# "no-pass": reject messages without a passing DKIM signature
# "author-mismatch": reject messages that donâ€™t have a passing DKIM signature
# where d= matches the From header domain
reject_failures =
#reject_failures = missing, no-pass, author-mismatch
